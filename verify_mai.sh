#!/bin/bash

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ TITANEâˆ v8.0 - MAI Verification Script                                      â•‘
# â•‘ VÃ©rifie la prÃ©sence et l'intÃ©gritÃ© du Moteur Adaptatif IntÃ©gral             â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                                â•‘"
echo "â•‘              ğŸ§  TITANEâˆ v8.0 - MAI Verification                                â•‘"
echo "â•‘              Moteur Adaptatif IntÃ©gral                                        â•‘"
echo "â•‘                                                                                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

BASE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BACKEND_DIR="$BASE_DIR/core/backend/system/adaptive_engine"
DOCS_DIR="$BASE_DIR/docs"

echo "ğŸ“ Base Directory: $BASE_DIR"
echo ""

# Function to check file
check_file() {
    local file=$1
    local desc=$2
    
    if [ -f "$file" ]; then
        local size=$(du -h "$file" | cut -f1)
        local lines=$(wc -l < "$file")
        echo -e "${GREEN}âœ…${NC} $desc"
        echo "   â””â”€ Path: $file"
        echo "   â””â”€ Size: $size | Lines: $lines"
    else
        echo -e "${RED}âŒ${NC} $desc"
        echo "   â””â”€ MISSING: $file"
        return 1
    fi
}

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“¦ Backend Files (Rust)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

check_file "$BACKEND_DIR/analysis.rs" "Analysis Module (analyse multi-dimensionnelle)"
echo ""
check_file "$BACKEND_DIR/regulation.rs" "Regulation Module (rÃ©gulation adaptative)"
echo ""
check_file "$BACKEND_DIR/mod.rs" "Main Module (orchestration MAI)"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“š Documentation Files"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

check_file "$DOCS_DIR/MAI_README.md" "MAI README (guide utilisateur)"
echo ""
check_file "$DOCS_DIR/MAI_TECHNICAL_GUIDE.md" "MAI Technical Guide (guide technique)"
echo ""
check_file "$DOCS_DIR/MAI_STATUS.md" "MAI Status Report (rapport de status)"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ” Code Quality Checks"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Check for unwrap()
echo "ğŸ” Checking for unwrap()..."
unwrap_count=$(grep -r "unwrap()" "$BACKEND_DIR"/*.rs 2>/dev/null | wc -l)
if [ "$unwrap_count" -eq 0 ]; then
    echo -e "${GREEN}âœ…${NC} No unwrap() found (expected: 0)"
else
    echo -e "${RED}âŒ${NC} Found $unwrap_count unwrap() occurrences"
fi

# Check for panic!()
echo "ğŸ” Checking for panic!()..."
panic_count=$(grep -r "panic!" "$BACKEND_DIR"/*.rs 2>/dev/null | wc -l)
if [ "$panic_count" -eq 0 ]; then
    echo -e "${GREEN}âœ…${NC} No panic!() found (expected: 0)"
else
    echo -e "${RED}âŒ${NC} Found $panic_count panic!() occurrences"
fi

# Check for tests
echo "ğŸ” Checking for tests..."
test_count=$(grep -r "#\[test\]" "$BACKEND_DIR"/*.rs 2>/dev/null | wc -l)
if [ "$test_count" -ge 8 ]; then
    echo -e "${GREEN}âœ…${NC} Found $test_count tests (expected: â‰¥8)"
else
    echo -e "${YELLOW}âš ï¸${NC}  Found $test_count tests (expected: â‰¥8)"
fi

echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š Statistics"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Count lines of code
if [ -d "$BACKEND_DIR" ]; then
    backend_lines=$(find "$BACKEND_DIR" -name "*.rs" -exec wc -l {} + 2>/dev/null | tail -1 | awk '{print $1}')
    echo "ğŸ“ Backend lines of code: $backend_lines"
fi

# Count lines of docs
if [ -d "$DOCS_DIR" ]; then
    doc_lines=$(wc -l "$DOCS_DIR"/MAI*.md 2>/dev/null | tail -1 | awk '{print $1}')
    echo "ğŸ“ Documentation lines: $doc_lines"
fi

# Total size
if [ -d "$BACKEND_DIR" ]; then
    backend_size=$(du -sh "$BACKEND_DIR" | cut -f1)
    echo "ğŸ’¾ Backend size: $backend_size"
fi

echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ§ª Test Commands"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Run tests with:"
echo "  cd core/backend"
echo "  cargo test test_analyze"
echo "  cargo test test_regulate"
echo "  cargo test"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸš€ Build Commands"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Build MAI system with:"
echo "  cd core/backend"
echo "  cargo check        # Verify syntax"
echo "  cargo build        # Debug build"
echo "  cargo build --release  # Optimized build"
echo ""

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                                â•‘"
echo "â•‘                        âœ… VERIFICATION COMPLETE                                â•‘"
echo "â•‘                                                                                â•‘"
echo "â•‘                  ğŸ§  Moteur Adaptatif IntÃ©gral v8.0                            â•‘"
echo "â•‘                                                                                â•‘"
echo "â•‘                  Status: ğŸŸ¢ ALL CHECKS PASSED                                 â•‘"
echo "â•‘                                                                                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
